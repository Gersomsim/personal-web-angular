@let project = Project();

<!-- ── Page header ────────────────────────────────────────────────────────── -->
<div class="mb-6 flex flex-wrap items-start justify-between gap-4">
	<div>
		<p class="font-mono text-xs text-emerald-500">// portfolio</p>
		<h1 class="mt-1 text-2xl font-semibold tracking-tight text-slate-900 dark:text-white">
			Caso de estudio
			@if (project) {
				<span class="ml-2 font-mono text-sm font-normal text-slate-400 dark:text-slate-600">
					— {{ project.title }}
				</span>
			}
		</h1>
	</div>

	@if (project) {
		<div class="flex items-center gap-2">
			<!-- Edit basic data -->
			<a
				[routerLink]="['/admin/projects/edit', project.id]"
				class="inline-flex items-center gap-1.5 rounded-md border border-slate-200/50 px-3 py-1.5 text-sm text-slate-600 transition-colors hover:border-slate-300/50 hover:bg-slate-50 hover:text-slate-900 dark:border-slate-800/50 dark:text-slate-400 dark:hover:bg-slate-800/50 dark:hover:text-white"
			>
				<svg
					class="size-3.5"
					fill="none"
					viewBox="0 0 24 24"
					stroke-width="1.5"
					stroke="currentColor"
				>
					<path
						stroke-linecap="round"
						stroke-linejoin="round"
						d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125"
					/>
				</svg>
				Editar básico
			</a>
			<!-- View live -->
			@if (project.liveUrl) {
				<a
					[href]="project.liveUrl"
					target="_blank"
					rel="noopener noreferrer"
					class="inline-flex items-center gap-1.5 rounded-md bg-emerald-500 px-3 py-1.5 text-sm font-medium text-white transition-colors hover:bg-emerald-600"
				>
					<svg
						class="size-3.5"
						fill="none"
						viewBox="0 0 24 24"
						stroke-width="1.5"
						stroke="currentColor"
					>
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"
						/>
					</svg>
					Ver en vivo
				</a>
			}
		</div>
	}
</div>

<!-- ── Loading skeleton ───────────────────────────────────────────────────── -->
@if (projectResource.isLoading()) {
	<div class="space-y-4">
		<!-- Info card skeleton -->
		<div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
			<div class="flex items-center gap-4">
				<div class="size-16 animate-pulse rounded-md bg-slate-100 dark:bg-slate-800"></div>
				<div class="flex-1 space-y-2">
					<div class="h-5 w-48 animate-pulse rounded bg-slate-100 dark:bg-slate-800"></div>
					<div class="h-3 w-64 animate-pulse rounded bg-slate-100 dark:bg-slate-800"></div>
					<div class="flex gap-2">
						<div class="h-5 w-20 animate-pulse rounded-full bg-slate-100 dark:bg-slate-800"></div>
						<div class="h-5 w-16 animate-pulse rounded-full bg-slate-100 dark:bg-slate-800"></div>
					</div>
				</div>
			</div>
		</div>
		<!-- Form sections skeleton -->
		@for (i of [1, 2, 3]; track i) {
			<div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
				<div class="mb-4 h-3 w-24 animate-pulse rounded bg-slate-100 dark:bg-slate-800"></div>
				<div class="space-y-3">
					<div class="h-9 w-full animate-pulse rounded-md bg-slate-100 dark:bg-slate-900"></div>
					<div class="h-20 w-full animate-pulse rounded-md bg-slate-100 dark:bg-slate-900"></div>
				</div>
			</div>
		}
	</div>
}

@if (!projectResource.isLoading() && projectResource.value()) {
	@let project = projectResource.value()!;

	<!-- ── Project info strip ──────────────────────────────────────────────── -->
	<div class="mb-6 overflow-hidden rounded-lg border border-slate-200/50 dark:border-slate-800/50">
		<!-- Main row -->
		<div class="flex items-start gap-4 p-5">
			<!-- Thumbnail -->
			@if (project.image) {
				<img
					[src]="project.image"
					[alt]="project.title"
					class="size-16 shrink-0 rounded-md object-cover ring-1 ring-slate-200/50 dark:ring-slate-800/50"
				/>
			} @else {
				<div
					class="flex size-16 shrink-0 items-center justify-center rounded-md bg-slate-100 dark:bg-slate-800"
				>
					<svg
						class="size-6 text-slate-400 dark:text-slate-600"
						fill="none"
						viewBox="0 0 24 24"
						stroke-width="1.5"
						stroke="currentColor"
					>
						<path
							stroke-linecap="round"
							stroke-linejoin="round"
							d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"
						/>
					</svg>
				</div>
			}

			<!-- Main info -->
			<div class="min-w-0 flex-1">
				<div class="flex flex-wrap items-center gap-2">
					<h2 class="truncate text-base font-semibold text-slate-900 dark:text-white">
						{{ project.title }}
					</h2>
					@if (project.featured) {
						<span
							class="inline-flex items-center gap-1 rounded-full bg-emerald-500/10 px-2 py-0.5 font-mono text-[10px] font-medium text-emerald-600 dark:text-emerald-400"
						>
							<span class="size-1 rounded-full bg-emerald-500"></span>
							featured
						</span>
					}
				</div>

				@if (project.subtitle) {
					<p class="mt-0.5 truncate text-sm text-slate-500 dark:text-slate-400">{{ project.subtitle }}</p>
				}

				<!-- Badges row -->
				<div class="mt-2 flex flex-wrap items-center gap-2">
					<span
						class="rounded-md bg-slate-100 px-2 py-0.5 font-mono text-xs text-slate-600 dark:bg-slate-800 dark:text-slate-400"
					>
						{{ project.category.name }}
					</span>
					<span
						class="rounded-md bg-slate-100 px-2 py-0.5 font-mono text-xs text-slate-500 dark:bg-slate-800 dark:text-slate-500"
					>
						{{ project.type }}
					</span>
					@if (project.metrics) {
						<span
							class="rounded-md bg-emerald-500/10 px-2 py-0.5 font-mono text-xs text-emerald-600 dark:text-emerald-400"
						>
							{{ project.metrics }}
						</span>
					}
				</div>
			</div>

			<!-- Right: meta + links -->
			<div class="shrink-0 text-right">
				<!-- External links -->
				<div class="flex items-center justify-end gap-1.5">
					@if (project.liveUrl) {
						<a
							[href]="project.liveUrl"
							target="_blank"
							rel="noopener noreferrer"
							class="inline-flex size-7 items-center justify-center rounded-md text-slate-400 transition-colors hover:bg-slate-100 hover:text-slate-700 dark:hover:bg-slate-800 dark:hover:text-slate-200"
							title="Ver sitio"
						>
							<svg
								class="size-4"
								fill="none"
								viewBox="0 0 24 24"
								stroke-width="1.5"
								stroke="currentColor"
							>
								<path
									stroke-linecap="round"
									stroke-linejoin="round"
									d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"
								/>
							</svg>
						</a>
					}
					@if (project.repoUrl) {
						<a
							[href]="project.repoUrl"
							target="_blank"
							rel="noopener noreferrer"
							class="inline-flex size-7 items-center justify-center rounded-md text-slate-400 transition-colors hover:bg-slate-100 hover:text-slate-700 dark:hover:bg-slate-800 dark:hover:text-slate-200"
							[title]="project.repoPrivate ? 'Repositorio privado' : 'Ver repositorio'"
						>
							@if (project.repoPrivate) {
								<svg
									class="size-4"
									fill="none"
									viewBox="0 0 24 24"
									stroke-width="1.5"
									stroke="currentColor"
								>
									<path
										stroke-linecap="round"
										stroke-linejoin="round"
										d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"
									/>
								</svg>
							} @else {
								<svg
									class="size-4"
									fill="none"
									viewBox="0 0 24 24"
									stroke-width="1.5"
									stroke="currentColor"
								>
									<path
										stroke-linecap="round"
										stroke-linejoin="round"
										d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5"
									/>
								</svg>
							}
						</a>
					}
				</div>
				<!-- Role + duration -->
				<div class="mt-2 space-y-0.5">
					@if (project.role) {
						<p class="font-mono text-[10px] text-slate-400 dark:text-slate-600">{{ project.role }}</p>
					}
					@if (project.duration) {
						<p class="font-mono text-[10px] text-slate-400 dark:text-slate-600">{{ project.duration }}</p>
					}
				</div>
			</div>
		</div>

		<!-- Tags strip -->
		@if (project.tags && project.tags.length > 0) {
			<div
				class="flex flex-wrap items-center gap-1.5 border-t border-slate-100 px-5 py-3 dark:border-slate-800/50"
			>
				<span class="mr-1 font-mono text-[10px] text-slate-400 dark:text-slate-600">tags</span>
				@for (tag of project.tags; track tag.id) {
					<span
						class="rounded bg-slate-100 px-1.5 py-0.5 font-mono text-[10px] text-slate-500 dark:bg-slate-800 dark:text-slate-400"
					>
						{{ tag.name }}
					</span>
				}
			</div>
		}

		<!-- Case study completeness indicators -->
		<div class="flex items-center gap-6 border-t border-slate-100 px-5 py-3 dark:border-slate-800/50">
			<p class="font-mono text-[10px] uppercase tracking-widest text-slate-400 dark:text-slate-600">
				caso de estudio
			</p>
			<div class="flex items-center gap-4">
				<!-- Tech stack -->
				<div class="flex items-center gap-1.5">
					@if (project.techStack && project.techStack.length > 0) {
						<span class="size-1.5 rounded-full bg-emerald-500"></span>
					} @else {
						<span class="size-1.5 rounded-full bg-slate-300 dark:bg-slate-700"></span>
					}
					<span class="font-mono text-[10px] text-slate-400 dark:text-slate-600">
						tech stack
						@if (project.techStack && project.techStack.length > 0) {
							({{ project.techStack.length }})
						}
					</span>
				</div>
				<!-- Challenges -->
				<div class="flex items-center gap-1.5">
					@if (project.challenges && project.challenges.length > 0) {
						<span class="size-1.5 rounded-full bg-emerald-500"></span>
					} @else {
						<span class="size-1.5 rounded-full bg-slate-300 dark:bg-slate-700"></span>
					}
					<span class="font-mono text-[10px] text-slate-400 dark:text-slate-600">
						desafíos
						@if (project.challenges && project.challenges.length > 0) {
							({{ project.challenges.length }})
						}
					</span>
				</div>
				<!-- Results -->
				<div class="flex items-center gap-1.5">
					@if (project.results && project.results.length > 0) {
						<span class="size-1.5 rounded-full bg-emerald-500"></span>
					} @else {
						<span class="size-1.5 rounded-full bg-slate-300 dark:bg-slate-700"></span>
					}
					<span class="font-mono text-[10px] text-slate-400 dark:text-slate-600">
						resultados
						@if (project.results && project.results.length > 0) {
							({{ project.results.length }})
						}
					</span>
				</div>
			</div>
		</div>
	</div>

	<!-- ── Case study forms ────────────────────────────────────────────────── -->
	<div class="space-y-6">
		<!-- Tech Stack -->
		<app-project-tech-stack-form
			[value]="TechStack()"
			(save)="onSaveTechStack($event)"
		/>

		<!-- Challenges -->
		<app-project-challenges-form
			[value]="project.challenges ?? []"
			(save)="onSaveChallenges($event)"
		/>

		<!-- Results -->
		<app-project-results-form
			[value]="project.results ?? []"
			(save)="onSaveResults($event)"
		/>
	</div>
}
