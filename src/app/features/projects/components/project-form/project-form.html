<form
	[formGroup]="form"
	(ngSubmit)="onSubmit()"
	class="space-y-6"
>
	<!-- ── Básico ─────────────────────────────────────────────── -->
	<div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
		<p class="mb-4 font-mono text-[10px] uppercase tracking-widest text-emerald-500">// básico</p>

		<div class="space-y-4">
			<app-form-input
				label="Título *"
				placeholder="ERP ECO-Suite — gestión integral para pymes"
				formControlName="title"
				[control]="f.title"
			/>

			<!-- Link con botón regenerar -->
			<div>
				<app-form-input
					label="Slug *"
					placeholder="erp-eco-suite"
					formControlName="slug"
					[control]="f.slug"
					hint="Slug de la URL — se auto-genera desde el título"
				/>
				<button
					type="button"
					(click)="resetLink()"
					class="mt-1.5 font-mono text-[10px] text-slate-400 transition-colors hover:text-emerald-500 dark:text-slate-600 dark:hover:text-emerald-400"
				>
					↺ regenerar desde título
				</button>
			</div>

			<app-form-input
				label="Subtítulo"
				placeholder="Breve tagline del proyecto"
				formControlName="subtitle"
			/>

			<div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
				<app-combobox
					label="Categoría *"
					[items]="categories()"
					[selectedKey]="f.categoryId!.value"
					(createRequested)="createCategoryRequest.emit($event)"
					(itemSelected)="setCategory($event)"
				/>
				<app-form-select
					label="Tipo *"
					[options]="typeOptions"
					formControlName="type"
					[control]="f.type"
				/>
			</div>
			<div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
				<app-form-input
					label="Rol"
					placeholder="Lead Developer"
					formControlName="role"
				/>
				<app-form-input
					label="Equipo"
					placeholder="3 personas"
					formControlName="team"
				/>
			</div>

			<div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
				<app-form-input
					label="Duración"
					placeholder="6 meses"
					formControlName="duration"
				/>
				<app-form-input
					label="Fecha de desarrollo"
					placeholder="2022"
					type="date"
					formControlName="developedAt"
				/>
			</div>
		</div>
	</div>

	<!-- ── Descripción ────────────────────────────────────────── -->
	<div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
		<p class="mb-4 font-mono text-[10px] uppercase tracking-widest text-emerald-500">// descripción</p>

		<div class="space-y-4">
			<app-form-textarea
				label="Descripción *"
				placeholder="Qué es el proyecto, qué problema resuelve y cuál fue el impacto..."
				formControlName="description"
				[control]="f.description"
				[rows]="4"
			/>

			<app-form-textarea
				label="El problema"
				placeholder="Contexto del problema que existía antes de este proyecto..."
				formControlName="problem"
				[rows]="3"
			/>

			<app-form-textarea
				label="La solución"
				placeholder="Cómo se abordó el problema y qué decisiones técnicas se tomaron..."
				formControlName="solution"
				[rows]="3"
			/>
		</div>
	</div>

	<!-- ── Media ──────────────────────────────────────────────── -->
	<div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
		<p class="mb-4 font-mono text-[10px] uppercase tracking-widest text-emerald-500">// media</p>

		<div class="space-y-4">
			<app-form-input
				label="Imagen principal *"
				type="url"
				placeholder="https://..."
				formControlName="image"
				[control]="f.image"
				hint="URL de la imagen de portada del proyecto"
			/>

			<!-- Galería -->
			<div>
				<div class="mb-2 flex items-center justify-between">
					<label class="font-mono text-xs font-medium text-slate-500 dark:text-slate-400">Galería</label>
					<button
						type="button"
						(click)="addGallery()"
						class="font-mono text-[10px] text-slate-400 transition-colors hover:text-emerald-500 dark:text-slate-600 dark:hover:text-emerald-400"
					>
						+ añadir imagen
					</button>
				</div>

				@if (galleryControls.length === 0) {
					<p class="font-mono text-[10px] text-slate-400 dark:text-slate-600">Sin imágenes adicionales</p>
				}

				<div
					formArrayName="gallery"
					class="space-y-2"
				>
					@for (ctrl of galleryControls; track $index) {
						<div class="flex items-center gap-2">
							<input
								type="url"
								[formControlName]="$index"
								placeholder="https://..."
								class="w-full rounded-md border border-slate-200/50 bg-slate-50 px-3 py-2 text-sm text-slate-900 outline-none transition-colors placeholder:text-slate-400 focus:border-emerald-500/50 dark:border-slate-800/50 dark:bg-slate-900 dark:text-white dark:placeholder:text-slate-600 dark:focus:border-emerald-500/50"
							/>
							<button
								type="button"
								(click)="removeGallery($index)"
								class="shrink-0 rounded-md p-2 text-slate-400 transition-colors hover:bg-red-50 hover:text-red-500 dark:hover:bg-red-950/20 dark:hover:text-red-400"
							>
								<svg
									class="size-4"
									fill="none"
									viewBox="0 0 24 24"
									stroke-width="1.5"
									stroke="currentColor"
								>
									<path
										stroke-linecap="round"
										stroke-linejoin="round"
										d="M6 18 18 6M6 6l12 12"
									/>
								</svg>
							</button>
						</div>
					}
				</div>
			</div>
		</div>
	</div>

	<!-- ── Enlaces ────────────────────────────────────────────── -->
	<div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
		<p class="mb-4 font-mono text-[10px] uppercase tracking-widest text-emerald-500">// enlaces</p>

		<div class="space-y-4">
			<app-form-input
				label="URL Live"
				type="url"
				placeholder="https://miproyecto.com"
				formControlName="liveUrl"
			/>

			<div>
				<app-form-input
					label="URL Repositorio"
					type="url"
					placeholder="https://github.com/usuario/repo"
					formControlName="repoUrl"
				/>
				<div class="mt-3">
					<app-form-toggle
						label="Repositorio privado"
						description="El repositorio no es público"
						formControlName="repoPrivate"
					/>
				</div>
			</div>

			<app-form-input
				label="Métricas"
				placeholder="+40% rendimiento · 3 empresas · 500 usuarios"
				formControlName="metrics"
				hint="Resumen de impacto medible — aparece como badge"
			/>
		</div>
	</div>

	<!-- ── Clasificación ──────────────────────────────────────── -->
	<div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
		<p class="mb-4 font-mono text-[10px] uppercase tracking-widest text-emerald-500">// clasificación</p>

		<app-combobox-multi
			label="Tags"
			[items]="tags()"
			[selectedKeys]="f.tagsId.value"
			(createRequested)="createTagRequest.emit($event)"
			(selectionChanged)="setTag($event)"
		/>
	</div>

	<!-- ── Case Study ─────────────────────────────────────────── -->

	<!-- Features -->
	<div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
		<div class="mb-4 flex items-center justify-between">
			<p class="font-mono text-[10px] uppercase tracking-widest text-emerald-500">// funcionalidades</p>
			<button
				type="button"
				(click)="addFeature()"
				class="font-mono text-[10px] text-slate-400 transition-colors hover:text-emerald-500 dark:text-slate-600 dark:hover:text-emerald-400"
			>
				+ añadir
			</button>
		</div>

		@if (featureControls.length === 0) {
			<p class="font-mono text-[10px] text-slate-400 dark:text-slate-600">Sin funcionalidades añadidas</p>
		}

		<div
			formArrayName="features"
			class="space-y-2"
		>
			@for (ctrl of featureControls; track $index) {
				<div class="flex items-center gap-2">
					<input
						type="text"
						[formControlName]="$index"
						placeholder="Gestión de inventarios en tiempo real"
						class="w-full rounded-md border border-slate-200/50 bg-slate-50 px-3 py-2 text-sm text-slate-900 outline-none transition-colors placeholder:text-slate-400 focus:border-emerald-500/50 dark:border-slate-800/50 dark:bg-slate-900 dark:text-white dark:placeholder:text-slate-600 dark:focus:border-emerald-500/50"
					/>
					<button
						type="button"
						(click)="removeFeature($index)"
						class="shrink-0 rounded-md p-2 text-slate-400 transition-colors hover:bg-red-50 hover:text-red-500 dark:hover:bg-red-950/20 dark:hover:text-red-400"
					>
						<svg
							class="size-4"
							fill="none"
							viewBox="0 0 24 24"
							stroke-width="1.5"
							stroke="currentColor"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								d="M6 18 18 6M6 6l12 12"
							/>
						</svg>
					</button>
				</div>
			}
		</div>
	</div>

	<!-- Tech Stack -->
	<!-- <div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
		<div class="mb-4 flex items-center justify-between">
			<p class="font-mono text-[10px] uppercase tracking-widest text-emerald-500">// tech stack</p>
			<button
				type="button"
				(click)="addTechStack()"
				class="font-mono text-[10px] text-slate-400 transition-colors hover:text-emerald-500 dark:text-slate-600 dark:hover:text-emerald-400"
			>
				+ añadir categoría
			</button>
		</div>

		@if (techStackGroups.length === 0) {
			<p class="font-mono text-[10px] text-slate-400 dark:text-slate-600">Sin tecnologías añadidas</p>
		}

		<div
			formArrayName="techStack"
			class="space-y-3"
		>
			@for (group of techStackGroups; track $index) {
				<div
					[formGroupName]="$index"
					class="rounded-md border border-slate-100 p-3 dark:border-slate-800"
				>
					<div class="mb-2 flex items-center justify-between">
						<span class="font-mono text-[10px] text-slate-400 dark:text-slate-600">
							categoría {{ $index + 1 }}
						</span>
						<button
							type="button"
							(click)="removeTechStack($index)"
							class="font-mono text-[10px] text-slate-400 transition-colors hover:text-red-500 dark:text-slate-600 dark:hover:text-red-400"
						>
							eliminar
						</button>
					</div>
					<div class="grid grid-cols-1 gap-3 sm:grid-cols-2">
						<app-form-input
							label="Categoría"
							placeholder="Frontend"
							formControlName="category"
						/>
						<app-form-input
							label="Items (separados por coma)"
							placeholder="Angular, TypeScript, Tailwind"
							formControlName="items"
							hint="Ej: React, Node.js, PostgreSQL"
						/>
					</div>
				</div>
			}
		</div>
	</div> -->

	<!-- Challenges -->
	<!-- <div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
		<div class="mb-4 flex items-center justify-between">
			<p class="font-mono text-[10px] uppercase tracking-widest text-emerald-500">// desafíos</p>
			<button
				type="button"
				(click)="addChallenge()"
				class="font-mono text-[10px] text-slate-400 transition-colors hover:text-emerald-500 dark:text-slate-600 dark:hover:text-emerald-400"
			>
				+ añadir desafío
			</button>
		</div>

		@if (challengeGroups.length === 0) {
			<p class="font-mono text-[10px] text-slate-400 dark:text-slate-600">Sin desafíos añadidos</p>
		}

		<div
			formArrayName="challenges"
			class="space-y-3"
		>
			@for (group of challengeGroups; track $index) {
				<div
					[formGroupName]="$index"
					class="rounded-md border border-slate-100 p-3 dark:border-slate-800"
				>
					<div class="mb-2 flex items-center justify-between">
						<span class="font-mono text-[10px] text-slate-400 dark:text-slate-600">
							desafío {{ $index + 1 }}
						</span>
						<button
							type="button"
							(click)="removeChallenge($index)"
							class="font-mono text-[10px] text-slate-400 transition-colors hover:text-red-500 dark:text-slate-600 dark:hover:text-red-400"
						>
							eliminar
						</button>
					</div>
					<div class="space-y-3">
						<app-form-input
							label="Título del desafío"
							placeholder="Sincronización en tiempo real entre módulos"
							formControlName="title"
						/>
						<app-form-textarea
							label="Cómo se resolvió"
							placeholder="Se implementó WebSockets con un sistema de eventos..."
							formControlName="solution"
							[rows]="2"
						/>
					</div>
				</div>
			}
		</div>
	</div> -->

	<!-- Results -->
	<!-- <div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
		<div class="mb-4 flex items-center justify-between">
			<p class="font-mono text-[10px] uppercase tracking-widest text-emerald-500">// resultados</p>
			<button
				type="button"
				(click)="addResult()"
				class="font-mono text-[10px] text-slate-400 transition-colors hover:text-emerald-500 dark:text-slate-600 dark:hover:text-emerald-400"
			>
				+ añadir resultado
			</button>
		</div>

		@if (resultGroups.length === 0) {
			<p class="font-mono text-[10px] text-slate-400 dark:text-slate-600">Sin resultados añadidos</p>
		}

		<div
			formArrayName="results"
			class="space-y-3"
		>
			@for (group of resultGroups; track $index) {
				<div
					[formGroupName]="$index"
					class="rounded-md border border-slate-100 p-3 dark:border-slate-800"
				>
					<div class="mb-2 flex items-center justify-between">
						<span class="font-mono text-[10px] text-slate-400 dark:text-slate-600">
							resultado {{ $index + 1 }}
						</span>
						<button
							type="button"
							(click)="removeResult($index)"
							class="font-mono text-[10px] text-slate-400 transition-colors hover:text-red-500 dark:text-slate-600 dark:hover:text-red-400"
						>
							eliminar
						</button>
					</div>
					<div class="grid grid-cols-1 gap-3 sm:grid-cols-3">
						<app-form-input
							label="Valor"
							placeholder="+40%"
							formControlName="value"
						/>
						<app-form-input
							label="Label"
							placeholder="Rendimiento"
							formControlName="label"
						/>
						<app-form-input
							label="Descripción (opcional)"
							placeholder="Mejora en tiempo de respuesta"
							formControlName="description"
						/>
					</div>
				</div>
			}
		</div>
	</div> -->

	<!-- Learnings -->
	<div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
		<div class="mb-4 flex items-center justify-between">
			<p class="font-mono text-[10px] uppercase tracking-widest text-emerald-500">// aprendizajes</p>
			<button
				type="button"
				(click)="addLearning()"
				class="font-mono text-[10px] text-slate-400 transition-colors hover:text-emerald-500 dark:text-slate-600 dark:hover:text-emerald-400"
			>
				+ añadir
			</button>
		</div>

		@if (learningControls.length === 0) {
			<p class="font-mono text-[10px] text-slate-400 dark:text-slate-600">Sin aprendizajes añadidos</p>
		}

		<div
			formArrayName="learnings"
			class="space-y-2"
		>
			@for (ctrl of learningControls; track $index) {
				<div class="flex items-center gap-2">
					<input
						type="text"
						[formControlName]="$index"
						placeholder="La importancia de definir bien el esquema de BD desde el inicio"
						class="w-full rounded-md border border-slate-200/50 bg-slate-50 px-3 py-2 text-sm text-slate-900 outline-none transition-colors placeholder:text-slate-400 focus:border-emerald-500/50 dark:border-slate-800/50 dark:bg-slate-900 dark:text-white dark:placeholder:text-slate-600 dark:focus:border-emerald-500/50"
					/>
					<button
						type="button"
						(click)="removeLearning($index)"
						class="shrink-0 rounded-md p-2 text-slate-400 transition-colors hover:bg-red-50 hover:text-red-500 dark:hover:bg-red-950/20 dark:hover:text-red-400"
					>
						<svg
							class="size-4"
							fill="none"
							viewBox="0 0 24 24"
							stroke-width="1.5"
							stroke="currentColor"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								d="M6 18 18 6M6 6l12 12"
							/>
						</svg>
					</button>
				</div>
			}
		</div>
	</div>

	<!-- ── Opciones ────────────────────────────────────────────── -->
	<div class="rounded-lg border border-slate-200/50 p-5 dark:border-slate-800/50">
		<p class="mb-4 font-mono text-[10px] uppercase tracking-widest text-emerald-500">// opciones</p>

		<app-form-toggle
			label="Proyecto destacado"
			description="Aparecerá en la sección principal del portfolio"
			formControlName="featured"
		/>
	</div>

	<!-- ── Submit ─────────────────────────────────────────────── -->
	<div class="flex items-center justify-between">
		<p class="font-mono text-xs text-slate-400 dark:text-slate-600">* campos requeridos</p>
		<button
			type="submit"
			class="inline-flex items-center gap-2 rounded-md bg-emerald-500 px-5 py-2.5 text-sm font-medium text-white transition-colors hover:bg-emerald-600 disabled:cursor-not-allowed disabled:opacity-50"
		>
			Guardar proyecto
			<svg
				class="size-4"
				fill="none"
				viewBox="0 0 24 24"
				stroke-width="1.5"
				stroke="currentColor"
			>
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"
				/>
			</svg>
		</button>
	</div>
</form>
